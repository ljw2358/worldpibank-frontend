<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WorldPiBank</title>

  <style>
    body { font-family: Arial, sans-serif; background: #4b0082; color: #fff; margin: 0; padding: 20px; text-align: center; }
    h1 { margin-top: 20px; font-size: 28px; }
    .menu { margin: 20px 0; }
    .menu button {
      display: flex; align-items: center; justify-content: center;
      width: 100%; padding: 12px; margin: 8px 0;
      border: none; border-radius: 8px;
      font-size: 16px; background: #fff; color: #4b0082; cursor: pointer;
    }
    .menu button span { margin-right: 8px; }
    .menu button:hover { background: #ddd; }
    .lang-block { margin: 30px 0; }
    footer { margin-top: 40px; font-size: 14px; }
  </style>

  <!-- Pi SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>🌍 WorldPiBank</h1>
  <button onclick="loginWithPi()">🔐 Login with Pi</button>

  <!-- 한국어 -->
  <div class="lang-block">
    <h2>🇰🇷 한국어</h2>
    <div class="menu">
      <button onclick="callAPI('sendpay')"><span>💸</span>송금 / 결제</button>
      <button onclick="callAPI('rewards')"><span>🎁</span>보상 / 설문</button>
      <button onclick="callAPI('staking')"><span>📊</span>예치 / 스테이킹</button>
      <button onclick="callAPI('ubi')"><span>🌐</span>기본소득 (UBI)</button>
      <button onclick="callAPI('support')"><span>📞</span>고객센터</button>
      <button onclick="callAPI('faq')"><span>❓</span>FAQ / 보안</button>
    </div>
  </div>

  <!-- English -->
  <div class="lang-block">
    <h2>🇺🇸 English</h2>
    <div class="menu">
      <button onclick="callAPI('sendpay')"><span>💸</span>Send / Pay</button>
      <button onclick="callAPI('rewards')"><span>🎁</span>Rewards / Survey</button>
      <button onclick="callAPI('staking')"><span>📊</span>Deposit / Staking</button>
      <button onclick="callAPI('ubi')"><span>🌐</span>Universal Basic Income (UBI)</button>
      <button onclick="callAPI('support')"><span>📞</span>Customer Support</button>
      <button onclick="callAPI('faq')"><span>❓</span>FAQ / Security</button>
    </div>
  </div>

  <!-- 中文 -->
  <div class="lang-block">
    <h2>🇨🇳 中文</h2>
    <div class="menu">
      <button onclick="callAPI('sendpay')"><span>💸</span>转账 / 支付</button>
      <button onclick="callAPI('rewards')"><span>🎁</span>奖励 / 调查</button>
      <button onclick="callAPI('staking')"><span>📊</span>存款 / 质押</button>
      <button onclick="callAPI('ubi')"><span>🌐</span>基本收入 (UBI)</button>
      <button onclick="callAPI('support')"><span>📞</span>客户服务</button>
      <button onclick="callAPI('faq')"><span>❓</span>常见问题 / 安全</button>
    </div>
  </div>

  <footer>
    © 2025 WorldPiBank — Powered by Pi Network & Web3
  </footer>

  <script>
    const API_BASE = "https://worldpibank-backend.onrender.com";

    async function callAPI(endpoint) {
      try {
        const res = await fetch(`${API_BASE}/${endpoint}`);
        const data = await res.json();
        alert(JSON.stringify(data));
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    function loginWithPi() {
      if (window.Pi) {
        Pi.authenticate(["username"], onIncomplete).then(function(auth) {
          alert("Logged in as: " + auth.user.username);
        }).catch(function(err){
          alert("Login failed: " + err);
        });
      } else {
        alert("Please open in Pi Browser.");
      }
    }

    function onIncomplete(auth) {
      alert("Login incomplete: " + JSON.stringify(auth));
    }

    // manifest.json 동적 생성
    const manifest = {
      name: "WorldPiBank",
      short_name: "WPiBank",
      start_url: "./index.html",
      display: "standalone",
      background_color: "#4b0082",
      theme_color: "#4b0082",
      icons: [
        { src: "icon-192.png", sizes: "192x192", type: "image/png" },
        { src: "icon-512.png", sizes: "512x512", type: "image/png" }
      ]
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], {type: "application/json"});
    const manifestURL = URL.createObjectURL(manifestBlob);
    document.querySelector("link[rel='manifest']").setAttribute("href", manifestURL);

    // service worker(sw.js) 동적 생성
    const swCode = `
      self.addEventListener("install", e => {
        e.waitUntil(
          caches.open("worldpibank").then(cache => {
            return cache.addAll(["/", "/index.html"]);
          })
        );
      });
      self.addEventListener("fetch", e => {
        e.respondWith(
          caches.match(e.request).then(response => {
            return response || fetch(e.request);
          })
        );
      });
    `;
    const swBlob = new Blob([swCode], { type: "application/javascript" });
    const swURL = URL.createObjectURL(swBlob);
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register(swURL).then(() => {
        console.log("Service Worker registered.");
      });
    }
  </script>
</body>
</html>
